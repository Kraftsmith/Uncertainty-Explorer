<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnose Summary</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="common-styles.css">
    <style>
        /* Page-specific styles for Summary */
        /* All specific styles for summary.html are now in common-styles.css */
        /* Or should be if they are truly page-specific and not covered by common rules */
        /* For example, if .export-btn has a unique color only on this page: */
        .export-btn {
            background-color: #4CAF50; /* Example of a page-specific override */
        }

        @media (max-width: 768px) {
            .chart-container, .cynefin-chart-container {
                height: 350px;
            }
        }
        @media (max-width: 480px) {
            .chart-container, .cynefin-chart-container {
                height: 300px;
            }
             .legend {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="section">
        <h1 class="section-title">Diagnose Summary</h1>


        <h3 class="section-title">Stacey Matrix Assessment Results</h3>
        
        <div class="chart-container">
            <canvas id="staceyChart"></canvas>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color simple-color"></div>
                <span>Simple (0-2.5)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color complicated-color"></div>
                <span>Complicated (2.5-5)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color complex-color"></div>
                <span>Complex (5-8)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color chaotic-color"></div>
                <span>Chaotic (8-10)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color score-color"></div>
                <span>Your Score</span>
            </div>
        </div>
        
        <div class="summary-section">
                        <!-- Moved Uncertainty Area here as a summary card -->
            <div class="summary-card">
                <h4>Uncertainty Area</h4>
                <!-- The area-display class will provide the colored background -->
                <div class="area-display simple-area" id="area-result">
                    <span id="area-name">Simple</span>
                </div>
            </div>
            <div class="summary-card">
                <h4>Product Uncertainty</h4>
                <div class="score-display">
                    <strong>Score:</strong> <span id="product-score">0.0</span>/10
                </div>
            </div>
            
            <div class="summary-card">
                <h4>Technical Uncertainty</h4>
                <div class="score-display">
                    <strong>Score:</strong> <span id="technical-score">0.0</span>/10
                </div>
            </div>
            
            <div class="summary-card">
                <h4>Team Uncertainty</h4>
                <div class="score-display">
                    <strong>Score:</strong> <span id="team-score">0.0</span>/10
                </div>
            </div>

        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title">Cynefin Framework Assessment Results</h2>
        
        <div class="cynefin-chart-container"> <!-- Removed ID as it might not be needed if chart is not dynamically manipulated here -->
            <div id="complex" class="quadrant">
                <span class="quadrant-name">Complex</span>
                <div class="domain-label" style="top: 45%;">Unknown Unknowns</div>
                <div class="domain-approach" style="top: 60%;">
                    PROBE → SENSE → RESPOND<br>Emergent Practice
                </div>
            </div>
            <div id="complicated" class="quadrant">
                <span class="quadrant-name">Complicated</span>
                <div class="domain-label" style="top: 45%;">Known Unknowns</div>
                <div class="domain-approach" style="top: 60%;">
                    SENSE → ANALYSE → RESPOND<br>Good Practice
                </div>
            </div>
            <div id="chaotic" class="quadrant">
                <span class="quadrant-name">Chaotic</span>
                <div class="domain-label" style="top: 45%;">Cause and Effect Unclear</div>
                <div class="domain-approach" style="top: 60%;">
                    ACT → SENSE → RESPOND<br>Novel Practice
                </div>
            </div>
            <div id="clear" class="quadrant">
                <span class="quadrant-name">Clear</span>
                <div class="domain-label" style="top: 45%;">Known Knowns</div>
                <div class="domain-approach" style="top: 60%;">
                    SENSE → CATEGORISE → RESPOND<br>Best Practice
                </div>
            </div>
            <div id="disorder" class="quadrant"><span class="quadrant-name">Disorder</span></div>
        </div>
        
        <div class="summary-section">
                     <div class="summary-card">
                <h4>Current Domain</h4>
                <div class="score-display">
                    <strong>Domain:</strong> <span id="current-domain">-</span>
                </div>
            </div>
            <div class="summary-card">
                <h4>Decision Making Score</h4>
                <div class="score-display">
                    <strong>Score:</strong> <span id="decision-score">0.0</span>/10
                </div>
            </div>
            
            <div class="summary-card">
                <h4>Cause-and-Effect Score</h4>
                <div class="score-display">
                    <strong>Score:</strong> <span id="cause-effect-score">0.0</span>/10
                </div>
            </div>
            

        </div>
        
        <div class="domain-info" id="domain-info-display" style="display: none;">
            <h3 id="domain-title"></h3>
            <p><strong>Characteristics:</strong></p>
            <ul id="domain-characteristics"></ul>
            <p id="domain-approach-text"></p>
            <svg width="268" height="283" viewBox="0 0 268 283" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="268" height="283" fill="white"/>
            <path d="M226.196 194.75C216.595 211.378 202.828 225.218 186.25 234.905C169.673 244.592 150.857 249.793 131.657 249.994C112.458 250.195 93.5369 245.39 76.7599 236.052C59.9829 226.714 45.9287 213.165 35.9822 196.742L63.4479 180.108C70.5041 191.759 80.4743 201.371 92.3761 207.995C104.278 214.62 117.7 218.028 131.321 217.886C144.941 217.743 158.289 214.054 170.05 207.182C181.81 200.309 191.577 190.491 198.388 178.695L226.196 194.75Z" fill="#BEA81A"/>
            <path d="M130.5 29C149.701 29 168.57 34.0031 185.248 43.5162C201.926 53.0293 215.838 66.7241 225.612 83.2509C235.386 99.7777 240.685 118.566 240.986 137.764C241.288 156.963 236.582 175.908 227.332 192.734L199.194 177.265C205.756 165.328 209.094 151.888 208.88 138.269C208.666 124.649 204.907 111.321 197.974 99.5962C191.04 87.8719 181.171 78.1567 169.339 71.4079C157.507 64.6592 144.121 61.1099 130.5 61.1099V29Z" fill="#1E9830"/>
            <path d="M34.8042 194.75C25.2039 178.122 20.1021 159.279 20.0015 140.079C19.901 120.878 24.8052 101.983 34.2308 85.2552C43.6565 68.5274 57.2782 54.5442 73.7536 44.6839C90.2289 34.8236 108.989 29.4264 128.186 29.0242L128.858 61.1271C115.24 61.4124 101.931 65.2413 90.2434 72.2363C78.5556 79.2313 68.8921 89.1511 62.2055 101.018C55.5188 112.885 52.0397 126.29 52.111 139.91C52.1823 153.531 55.8016 166.899 62.6122 178.695L34.8042 194.75Z" fill="#A04242"/>
            <path d="M196.67 78.8211L206.118 73.3666L208.27 77.0939C208.683 77.8105 208.899 78.5 208.917 79.1624C208.937 79.823 208.782 80.4249 208.452 80.9681C208.127 81.5127 207.651 81.9661 207.023 82.3283C206.396 82.6905 205.764 82.8748 205.128 82.8811C204.492 82.8875 203.892 82.7111 203.328 82.352C202.766 81.996 202.275 81.4551 201.856 80.7293L200.484 78.3535L202.085 77.4294L203.27 79.4822C203.492 79.8666 203.741 80.1452 204.017 80.3179C204.298 80.492 204.593 80.5722 204.9 80.5585C205.213 80.5461 205.525 80.4502 205.835 80.2709C206.149 80.0898 206.386 79.8687 206.547 79.6077C206.713 79.3479 206.788 79.0547 206.771 78.7279C206.758 78.3994 206.639 78.0414 206.416 77.6539L205.638 76.3069L197.823 80.8186L196.67 78.8211ZM201.526 87.2319L210.974 81.7773L213.126 85.5047C213.538 86.2182 213.762 86.9008 213.798 87.5525C213.838 88.2056 213.703 88.7984 213.391 89.331C213.084 89.8649 212.619 90.312 211.994 90.6725C211.367 91.0347 210.749 91.211 210.141 91.2014C209.536 91.19 208.965 90.9967 208.428 90.6216C207.894 90.2496 207.417 89.7007 206.998 88.9749L205.557 86.4792L207.162 85.5524L208.417 87.7251C208.637 88.1065 208.872 88.3931 209.122 88.5849C209.373 88.7767 209.638 88.8737 209.918 88.876C210.2 88.8814 210.496 88.7944 210.807 88.615C211.12 88.4339 211.348 88.2182 211.491 87.9678C211.635 87.7205 211.689 87.4373 211.652 87.1181C211.62 86.8002 211.494 86.4491 211.272 86.0646L210.494 84.7176L202.679 89.2293L201.526 87.2319ZM208.771 89.8517L205.827 94.682L204.554 92.4769L207.527 87.6974L208.771 89.8517ZM216.184 101.711C215.154 102.306 214.165 102.617 213.217 102.644C212.27 102.673 211.413 102.463 210.644 102.013C209.881 101.564 209.258 100.923 208.777 100.089C208.292 99.2497 208.048 98.3861 208.044 97.4986C208.04 96.6111 208.288 95.7649 208.787 94.9602C209.286 94.1554 210.049 93.4565 211.076 92.8635C212.106 92.2687 213.095 91.9564 214.041 91.9266C214.987 91.8969 215.842 92.1065 216.606 92.5554C217.373 93.0026 217.998 93.646 218.483 94.4856C218.964 95.319 219.207 96.1795 219.211 97.067C219.22 97.9558 218.974 98.8026 218.475 99.6074C217.978 100.415 217.215 101.117 216.184 101.711ZM215.015 99.6862C215.682 99.3009 216.187 98.876 216.53 98.4116C216.875 97.9502 217.062 97.4712 217.091 96.9747C217.12 96.4782 216.995 95.9885 216.716 95.5056C216.437 95.0228 216.076 94.6698 215.631 94.4467C215.187 94.2236 214.678 94.1444 214.104 94.2091C213.532 94.2768 212.913 94.5033 212.245 94.8886C211.578 95.2739 211.072 95.6973 210.727 96.1586C210.384 96.6231 210.198 97.1036 210.169 97.6001C210.14 98.0967 210.265 98.5864 210.544 99.0692C210.823 99.552 211.184 99.905 211.629 100.128C212.073 100.351 212.582 100.429 213.154 100.361C213.727 100.296 214.348 100.072 215.015 99.6862ZM212.315 105.918L221.762 100.464L223.946 104.246C224.348 104.941 224.579 105.581 224.641 106.164C224.703 106.747 224.619 107.262 224.388 107.707C224.16 108.15 223.809 108.508 223.335 108.782C222.966 108.995 222.599 109.108 222.234 109.122C221.872 109.134 221.528 109.063 221.2 108.907C220.877 108.753 220.584 108.533 220.32 108.247L220.228 108.3C220.42 108.669 220.513 109.064 220.507 109.486C220.502 109.911 220.387 110.32 220.163 110.712C219.941 111.102 219.598 111.431 219.134 111.699C218.633 111.989 218.113 112.123 217.576 112.101C217.043 112.08 216.524 111.894 216.017 111.543C215.511 111.191 215.054 110.662 214.645 109.955L212.315 105.918ZM215.101 106.973L216.041 108.601C216.363 109.158 216.703 109.503 217.063 109.635C217.425 109.766 217.785 109.729 218.142 109.523C218.403 109.372 218.597 109.176 218.724 108.934C218.852 108.693 218.905 108.422 218.883 108.123C218.864 107.826 218.762 107.518 218.577 107.199L217.611 105.524L215.101 106.973ZM218.962 104.744L219.817 106.224C219.975 106.498 220.163 106.714 220.381 106.871C220.604 107.029 220.84 107.118 221.089 107.138C221.34 107.162 221.59 107.101 221.839 106.957C222.181 106.76 222.386 106.48 222.455 106.116C222.525 105.756 222.433 105.354 222.177 104.911L221.301 103.393L218.962 104.744ZM217.273 114.507L226.721 109.052L230.396 115.418L228.749 116.369L226.227 112L223.976 113.3L226.309 117.341L224.662 118.292L222.329 114.251L220.073 115.553L222.606 119.94L220.959 120.891L217.273 114.507Z" fill="white"/>
            <path d="M36.1377 120.373C35.7289 120.234 35.3493 120.262 34.999 120.458C34.6487 120.654 34.3589 121.004 34.1296 121.508C33.9739 121.851 33.8908 122.162 33.8805 122.442C33.867 122.721 33.9156 122.961 34.0264 123.164C34.1387 123.363 34.3015 123.511 34.5149 123.608C34.6898 123.695 34.8618 123.729 35.0311 123.708C35.2019 123.684 35.3688 123.622 35.5319 123.52C35.6918 123.417 35.8506 123.287 36.0085 123.128C36.1631 122.969 36.3138 122.791 36.4608 122.597L37.0797 121.802C37.3736 121.412 37.6837 121.074 38.0099 120.785C38.3362 120.496 38.6775 120.273 39.034 120.115C39.3905 119.958 39.7619 119.879 40.148 119.879C40.5357 119.875 40.9371 119.966 41.3524 120.151C41.9587 120.431 42.4151 120.825 42.7216 121.335C43.0264 121.84 43.1708 122.437 43.1549 123.124C43.1373 123.806 42.9448 124.551 42.5774 125.36C42.213 126.161 41.7727 126.804 41.2566 127.287C40.742 127.767 40.1681 128.064 39.5351 128.178C38.9003 128.287 38.222 128.188 37.5002 127.879L38.4238 125.847C38.767 125.976 39.0884 126.007 39.3879 125.94C39.6856 125.869 39.9557 125.717 40.1982 125.484C40.4389 125.246 40.6415 124.946 40.8061 124.584C40.9678 124.228 41.0564 123.896 41.072 123.587C41.089 123.275 41.0385 123.004 40.9203 122.775C40.8022 122.546 40.6235 122.377 40.3843 122.268C40.1612 122.167 39.9436 122.148 39.7314 122.211C39.5207 122.271 39.3046 122.403 39.0833 122.607C38.8635 122.807 38.6277 123.069 38.3758 123.391L37.6127 124.349C37.0284 125.094 36.4094 125.61 35.7558 125.898C35.1022 126.186 34.4092 126.162 33.6768 125.825C33.074 125.555 32.6214 125.156 32.319 124.629C32.0181 124.098 31.8709 123.491 31.8773 122.807C31.8838 122.123 32.0517 121.42 32.3808 120.695C32.7159 119.958 33.1344 119.372 33.6364 118.937C34.1398 118.499 34.686 118.229 35.275 118.126C35.864 118.023 36.4565 118.101 37.0525 118.36L36.1377 120.373ZM44.8312 120.028L34.9 115.514L37.9419 108.822L39.6731 109.609L37.5856 114.201L39.9521 115.277L41.883 111.029L43.6142 111.816L41.6832 116.064L44.0545 117.142L46.1508 112.53L47.8819 113.317L44.8312 120.028ZM42.4767 98.8459L52.4079 103.36L51.5835 105.174L43.3689 106.653L43.3358 106.726L49.5864 109.567L48.632 111.667L38.7008 107.153L39.5384 105.31L47.7328 103.862L47.7725 103.775L41.5267 100.936L42.4767 98.8459ZM48.5705 93.022C48.1617 92.883 47.7821 92.9113 47.4318 93.107C47.0815 93.3028 46.7917 93.6528 46.5624 94.1571C46.4067 94.4998 46.3236 94.8112 46.3133 95.0913C46.2998 95.3699 46.3485 95.6104 46.4593 95.8129C46.5715 96.0122 46.7343 96.1603 46.9477 96.2573C47.1226 96.3446 47.2946 96.3779 47.4639 96.3574C47.6347 96.3336 47.8016 96.271 47.9647 96.1696C48.1246 96.0667 48.2835 95.9361 48.4413 95.7777C48.5959 95.6178 48.7466 95.4406 48.8936 95.246L49.5125 94.4508C49.8064 94.0617 50.1165 93.7228 50.4427 93.4342C50.769 93.1456 51.1103 92.9224 51.4668 92.7646C51.8233 92.6068 52.1947 92.5279 52.5808 92.5279C52.9685 92.5247 53.3699 92.6155 53.7852 92.8003C54.3915 93.0799 54.8479 93.4746 55.1544 93.9845C55.4592 94.4897 55.6036 95.0858 55.5878 95.773C55.5701 96.4554 55.3776 97.2007 55.0102 98.0089C54.6458 98.8106 54.2055 99.4531 53.6894 99.9362C53.1748 100.416 52.601 100.713 51.9679 100.827C51.3331 100.936 50.6548 100.837 49.933 100.528L50.8566 98.4964C51.1999 98.6251 51.5212 98.6561 51.8207 98.5894C52.1184 98.518 52.3885 98.3658 52.631 98.1327C52.8717 97.895 53.0743 97.5951 53.2389 97.233C53.4006 96.8774 53.4892 96.5451 53.5048 96.2363C53.5218 95.9241 53.4713 95.6535 53.3531 95.4242C53.235 95.195 53.0563 95.026 52.8171 94.9172C52.594 94.8158 52.3764 94.7969 52.1642 94.8604C51.9535 94.9206 51.7375 95.0526 51.5162 95.2562C51.2963 95.4567 51.0605 95.7181 50.8086 96.0405L50.0455 96.9984C49.4612 97.7431 48.8422 98.2595 48.1886 98.5475C47.535 98.8355 46.842 98.8111 46.1096 98.4743C45.5068 98.2042 45.0543 97.8053 44.7518 97.2778C44.4509 96.747 44.3037 96.1398 44.3102 95.4562C44.3166 94.7726 44.4845 94.0688 44.8136 93.3446C45.1487 92.6075 45.5672 92.0215 46.0692 91.5866C46.5726 91.1484 47.1188 90.8779 47.7078 90.775C48.2968 90.6722 48.8893 90.7503 49.4853 91.0096L48.5705 93.022ZM57.264 92.6775L47.3328 88.1631L50.3748 81.4712L52.1059 82.2581L50.0184 86.8503L52.3849 87.926L54.3158 83.6781L56.047 84.4651L54.116 88.713L56.4873 89.7909L58.5836 85.1793L60.3148 85.9662L57.264 92.6775Z" fill="white"/>
            <path d="M203.121 201.387L194.352 164.77L239.596 192.043L203.121 201.387Z" fill="#1E9830"/>
            <path d="M38.4138 171.25L74.7054 181.281L28.9554 207.695L38.4138 171.25Z" fill="#BEA81A"/>
            <path d="M151.778 44.5L124.944 70.9138L124.944 18.0862L151.778 44.5Z" fill="#A04242"/>
            <path d="M104.948 237V226.091H109.252C110.076 226.091 110.779 226.238 111.362 226.533C111.947 226.824 112.393 227.238 112.699 227.774C113.007 228.307 113.162 228.934 113.162 229.654C113.162 230.379 113.006 231.002 112.693 231.524C112.381 232.043 111.928 232.44 111.335 232.717C110.745 232.994 110.032 233.133 109.194 233.133H106.312V231.279H108.821C109.261 231.279 109.627 231.219 109.918 231.098C110.209 230.977 110.426 230.796 110.568 230.555C110.713 230.313 110.786 230.013 110.786 229.654C110.786 229.292 110.713 228.987 110.568 228.738C110.426 228.49 110.207 228.301 109.913 228.174C109.621 228.042 109.254 227.977 108.81 227.977H107.255V237H104.948ZM110.839 232.036L113.551 237H111.005L108.352 232.036H110.839ZM114.792 237V226.091H122.143V227.993H117.098V230.592H121.765V232.494H117.098V235.098H122.164V237H114.792ZM129.894 229.228C129.852 228.799 129.669 228.465 129.346 228.227C129.023 227.989 128.584 227.87 128.03 227.87C127.654 227.87 127.336 227.923 127.077 228.03C126.817 228.133 126.619 228.277 126.48 228.461C126.345 228.646 126.278 228.855 126.278 229.09C126.271 229.285 126.311 229.456 126.4 229.601C126.492 229.747 126.619 229.873 126.778 229.979C126.938 230.082 127.123 230.173 127.332 230.251C127.542 230.326 127.766 230.39 128.003 230.443L128.984 230.677C129.459 230.784 129.896 230.926 130.294 231.103C130.692 231.281 131.036 231.499 131.327 231.759C131.619 232.018 131.844 232.323 132.004 232.675C132.167 233.026 132.251 233.429 132.254 233.884C132.251 234.551 132.08 235.13 131.743 235.62C131.409 236.107 130.926 236.485 130.294 236.755C129.665 237.021 128.907 237.154 128.019 237.154C127.139 237.154 126.372 237.02 125.718 236.75C125.068 236.48 124.561 236.08 124.195 235.551C123.833 235.018 123.643 234.36 123.625 233.575H125.857C125.882 233.941 125.986 234.246 126.171 234.491C126.359 234.733 126.61 234.915 126.922 235.04C127.238 235.161 127.595 235.221 127.993 235.221C128.383 235.221 128.723 235.164 129.01 235.05C129.301 234.937 129.527 234.779 129.687 234.576C129.847 234.374 129.926 234.141 129.926 233.879C129.926 233.634 129.854 233.428 129.708 233.261C129.566 233.094 129.356 232.952 129.079 232.835C128.806 232.717 128.47 232.611 128.073 232.515L126.885 232.217C125.965 231.993 125.239 231.643 124.706 231.167C124.174 230.691 123.909 230.05 123.913 229.244C123.909 228.584 124.085 228.007 124.44 227.513C124.799 227.02 125.29 226.634 125.915 226.357C126.54 226.08 127.251 225.942 128.046 225.942C128.856 225.942 129.562 226.08 130.166 226.357C130.773 226.634 131.246 227.02 131.583 227.513C131.92 228.007 132.094 228.578 132.105 229.228H129.894ZM133.806 237V226.091H138.11C138.937 226.091 139.642 226.249 140.224 226.565C140.807 226.877 141.251 227.312 141.556 227.87C141.865 228.424 142.019 229.063 142.019 229.788C142.019 230.512 141.863 231.151 141.551 231.705C141.238 232.259 140.785 232.691 140.192 233C139.603 233.309 138.889 233.463 138.051 233.463H135.308V231.615H137.678C138.122 231.615 138.488 231.538 138.775 231.386C139.067 231.229 139.283 231.015 139.425 230.741C139.571 230.464 139.644 230.146 139.644 229.788C139.644 229.425 139.571 229.109 139.425 228.839C139.283 228.566 139.067 228.355 138.775 228.206C138.484 228.053 138.115 227.977 137.667 227.977H136.112V237H133.806ZM153.542 231.545C153.542 232.735 153.317 233.747 152.866 234.582C152.418 235.416 151.808 236.054 151.033 236.494C150.263 236.931 149.396 237.149 148.434 237.149C147.465 237.149 146.595 236.929 145.824 236.489C145.053 236.048 144.444 235.411 143.997 234.576C143.549 233.742 143.326 232.732 143.326 231.545C143.326 230.356 143.549 229.344 143.997 228.509C144.444 227.675 145.053 227.039 145.824 226.602C146.595 226.162 147.465 225.942 148.434 225.942C149.396 225.942 150.263 226.162 151.033 226.602C151.808 227.039 152.418 227.675 152.866 228.509C153.317 229.344 153.542 230.356 153.542 231.545ZM151.204 231.545C151.204 230.775 151.089 230.125 150.858 229.596C150.63 229.067 150.309 228.665 149.894 228.392C149.478 228.119 148.992 227.982 148.434 227.982C147.877 227.982 147.39 228.119 146.975 228.392C146.559 228.665 146.236 229.067 146.005 229.596C145.778 230.125 145.664 230.775 145.664 231.545C145.664 232.316 145.778 232.966 146.005 233.495C146.236 234.024 146.559 234.425 146.975 234.699C147.39 234.972 147.877 235.109 148.434 235.109C148.992 235.109 149.478 234.972 149.894 234.699C150.309 234.425 150.63 234.024 150.858 233.495C151.089 232.966 151.204 232.316 151.204 231.545ZM164.376 226.091V237H162.383L157.637 230.134H157.557V237H155.251V226.091H157.275L161.984 232.952H162.08V226.091H164.376ZM170.148 237H166.281V226.091H170.18C171.278 226.091 172.222 226.309 173.014 226.746C173.806 227.179 174.415 227.803 174.841 228.616C175.271 229.429 175.486 230.402 175.486 231.535C175.486 232.671 175.271 233.648 174.841 234.464C174.415 235.281 173.802 235.908 173.003 236.345C172.208 236.782 171.256 237 170.148 237ZM168.588 235.024H170.052C170.734 235.024 171.308 234.903 171.773 234.662C172.242 234.417 172.593 234.038 172.828 233.527C173.066 233.012 173.185 232.348 173.185 231.535C173.185 230.729 173.066 230.07 172.828 229.559C172.593 229.047 172.244 228.671 171.778 228.429C171.313 228.188 170.74 228.067 170.058 228.067H168.588V235.024Z" fill="white"/>
            </svg>
            <p><strong>Detailed Approach</strong></p>
            <ul id="domain-steps"></ul>
            <div id="delivery-practices-section" style="display: none;">
                 <h4>Delivery Framework</h4>
                 <ul id="delivery-practices-list"></ul>
            </div>
        </div>
    </div>
      <script src="JavaScript/assessment-utils.js"></script>
      <!-- <script src="cynefin-data.js"></script>  No longer needed if all data is in JSON -->
      <script src="JavaScript/stacey-chart-component.js"></script>
      <script>
        // Initialize chart variables
        // let staceyChart; // Will be managed by StaceyChartComponent
        let resultsDescriptionsData = null; // To store fetched JSON data

        // Load data and initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            fetchResultsDescriptions(); // Fetch descriptions first
        });

        async function fetchResultsDescriptions() {
            try {
                const response = await fetch('Data/results-descriptions.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                resultsDescriptionsData = await response.json();
                loadData(); // Now that descriptions are loaded, proceed to load assessment data
            } catch (error) {
                console.error("Could not load results descriptions:", error);
                // Optionally display an error to the user
            }
        }

        // Load data from local storage and update displays
        function loadData() {
            const staceyDataFromStorage = assessmentUtils.loadFromLocalStorage('staceyMatrixResults');
            let staceyArea = null;
            let staceyComponentInstance = null;

            // Prepare options for StaceyChartComponent
            const staceyChartOptions = {
                canvasId: 'staceyChart',
                productScoreDisplayId: 'product-score',
                technicalScoreDisplayId: 'technical-score',
                teamScoreDisplayId: 'team-score', // This ID exists in summary.html
                areaDisplayId: 'area-result',
                areaNameDisplayId: 'area-name',
                isInteractive: false // Display only
            };

            if (staceyDataFromStorage) {
                // Apply team score adjustment if needed
                let productScore = staceyDataFromStorage.product.average;
                let technicalScore = staceyDataFromStorage.technical.average;
                
                if (staceyDataFromStorage.team.average > 5) {
                    const adjustment = Math.floor(staceyDataFromStorage.team.average - 5) * 0.5;
                    productScore += adjustment;
                    technicalScore += adjustment;
                    productScore = Math.min(productScore, 10);
                    technicalScore = Math.min(technicalScore, 10);
                }

                staceyArea = staceyDataFromStorage.area;

                staceyChartOptions.initialData = {
                    productScore: productScore,
                    technicalScore: technicalScore,
                    teamScore: staceyDataFromStorage.team.average,
                    area: staceyArea
                };
            }

            // Instantiate StaceyChartComponent
            staceyComponentInstance = new StaceyChartComponent(staceyChartOptions);

            // Load Cynefin Data (Key for Cynefin in Cynefin.html is 'cynefinFrameworkAssessmentResults_v3')
            // The key used in summary.html's original loadData was 'cynefinAssessmentResults'
            // Let's assume the key from Cynefin.html is the correct one to use for loading.
            const cynefinData = assessmentUtils.loadFromLocalStorage('cynefinFrameworkAssessmentResults_v3');
            if (cynefinData) {
                // The structure of cynefinData from Cynefin.html is different:
                // { allQuestionScores, domain, averageDecisionScore, averageCauseEffectScore, timestamp }
                document.getElementById('decision-score').textContent = cynefinData.averageDecisionScore.toFixed(1);
                document.getElementById('cause-effect-score').textContent = cynefinData.averageCauseEffectScore.toFixed(1);
                document.getElementById('current-domain').textContent = cynefinData.domain;
                
                highlightCurrentDomain(cynefinData.domain);
                updateDomainInfo(cynefinData.domain, staceyArea);
            }
        }

        // Highlight the current Cynefin domain
        function highlightCurrentDomain(domain) {
            document.querySelectorAll('.quadrant').forEach(quad => {
                quad.classList.remove('highlighted'); // Ensure this class is defined in CSS
            });
            
            const disorderElement = document.getElementById('disorder');
            if (domain.toLowerCase() !== "disorder") { // Ensure case-insensitivity for "Disorder"
                if (disorderElement) disorderElement.style.display = 'none';
                const domainElement = document.getElementById(domain.toLowerCase());
                if (domainElement) {
                    domainElement.classList.add('highlighted');
                }
            } else {
                if (disorderElement) {
                    disorderElement.classList.add('highlighted');
                    disorderElement.style.display = 'flex'; 
                }
            }
        }

        // Update Cynefin domain information display
        function updateDomainInfo(cynefinDomain, staceyArea) {
            const infoElement = document.getElementById('domain-info-display');
            const domainTitleEl = document.getElementById('domain-title');
            const characteristicsListEl = document.getElementById('domain-characteristics');
            const domainApproachEl = document.getElementById('domain-approach-text'); 
            const stepsListEl = document.getElementById('domain-steps');
            const deliveryPracticesSectionEl = document.getElementById('delivery-practices-section');
            const deliveryPracticesListEl = document.getElementById('delivery-practices-list');
            // Clear previous content
            domainTitleEl.textContent = '';
            characteristicsListEl.innerHTML = '';
            domainApproachEl.textContent = '';
            stepsListEl.innerHTML = '';
            deliveryPracticesListEl.innerHTML = ''; 
            deliveryPracticesSectionEl.style.display = 'none'; 

            if (!resultsDescriptionsData) {
                console.error("Results descriptions data not loaded.");
                infoElement.style.display = 'none';
                return;
            }

            let dataToDisplay = null;
            const cDomainLower = cynefinDomain.toLowerCase();
            const sAreaLower = staceyArea ? staceyArea.toLowerCase() : null;

            // Check for combined scenarios first
            if (sAreaLower && resultsDescriptionsData.combined[`${cDomainLower}_${sAreaLower}`]) {
                dataToDisplay = resultsDescriptionsData.combined[`${cDomainLower}_${sAreaLower}`];
            } else if (resultsDescriptionsData.cynefin[cDomainLower]) {
                // Fallback to just Cynefin domain data
                dataToDisplay = resultsDescriptionsData.cynefin[cDomainLower];
            }

            if (dataToDisplay) {
                domainTitleEl.textContent = dataToDisplay.title || `${dataToDisplay.name}${dataToDisplay.subtitle ? ` (${dataToDisplay.subtitle})` : ''}`;
                
                (dataToDisplay.characteristics || []).forEach(char => {
                    const li = document.createElement('li');
                    li.textContent = char;
                    characteristicsListEl.appendChild(li);
                });
                
                domainApproachEl.textContent = dataToDisplay.approach || '';
                
                (dataToDisplay.steps || []).forEach(stepText => {
                    const li = document.createElement('li');
                    li.textContent = stepText;
                    stepsListEl.appendChild(li);
                });

                if (dataToDisplay.deliveryPractices && dataToDisplay.deliveryPractices.length > 0) {
                    dataToDisplay.deliveryPractices.forEach(practice => {
                        const li = document.createElement('li');
                        li.textContent = practice;
                        deliveryPracticesListEl.appendChild(li);
                    });
                    deliveryPracticesSectionEl.style.display = 'block';
                }
                infoElement.style.display = 'block';
            } else { 
                infoElement.style.display = 'none';
                console.warn(`No data found for Cynefin domain: ${cynefinDomain} or combined scenario.`);
            }
        }

        // Add these new functions at the end of your script section
        function exportToPDF() {
            // Hide export buttons before generating PDF
            const exportButtons = document.querySelector('.export-buttons');
            exportButtons.style.display = 'none';

            const element = document.body;
            const opt = {
                margin: 1,
                filename: 'diagnose-summary.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Generate PDF
            html2pdf().set(opt).from(element).save().then(() => {
                // Show export buttons again after PDF is generated
                exportButtons.style.display = 'flex';
            });
        }

        function showEmailForm() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('emailForm').style.display = 'block';
        }

        function hideEmailForm() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('emailForm').style.display = 'none';
        }

        function sendEmail() {
            const emailTo = document.getElementById('emailTo').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;

            if (!emailTo) {
                alert('Please enter a recipient email address');
                return;
            }

            // Hide export buttons before generating PDF
            const exportButtons = document.querySelector('.export-buttons');
            exportButtons.style.display = 'none';

            const element = document.body;
            const opt = {
                margin: 1,
                filename: 'diagnose-summary.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Generate PDF and send email
            html2pdf().set(opt).from(element).outputPdf('blob').then(pdfBlob => {
                // Create form data
                const formData = new FormData();
                formData.append('email', emailTo);
                formData.append('subject', subject);
                formData.append('message', message);
                formData.append('pdf', pdfBlob, 'diagnose-summary.pdf');

                // Send to server endpoint
                fetch('/api/send-email', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Email sent successfully!');
                        hideEmailForm();
                    } else {
                        alert('Failed to send email: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to send email. Please try again.');
                })
                .finally(() => {
                    // Show export buttons again
                    exportButtons.style.display = 'flex';
                });
            });
        }
    </script>
    <div class="overlay" id="overlay"></div>
    <div class="email-form" id="emailForm">
        <h3>Send Summary via Email</h3>
        <input type="email" id="emailTo" placeholder="Recipient Email" required>
        <input type="text" id="emailSubject" placeholder="Subject" value="Diagnose Summary Report">
        <textarea id="emailMessage" placeholder="Message (optional)" rows="4"></textarea>
        <div style="text-align: right;">
            <button onclick="hideEmailForm()" class="cancel">Cancel</button>
            <button onclick="sendEmail()">Send</button>
        </div>
    </div>
</body>
</html>
